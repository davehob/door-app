<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Orders</title>
  <link rel="stylesheet" href="/static/app.css">
  <style>
    .grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: 1fr;
    }

    .card {
      border: 1px solid #ddd;
      padding: 1rem;
      border-radius: .5rem;
      background: #fafafa;
    }

    .row {
      display: flex;
      gap: .5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .muted {
      color: #666;
    }

    .w100 {
      width: 100%;
    }

    @media (min-width: 820px) {
      .grid {
        grid-template-columns: 1fr 2fr;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>Orders</h1>
  </header>

  {% if ok %}<p style="color:green">{{ ok }}</p>{% endif %}

  <div class="grid">
    <!-- Create/Upload -->
    <section class="card">
      <h2 style="margin-top:0">Create a new order</h2>
      <p class="muted">Enter a Job ID and upload the PDF report. This will create the order and parse Doors/Drawer
        Fronts/Panels automatically.</p>
      <form class="w100" method="post" action="/upload" enctype="multipart/form-data">
        <div class="row">
          <label>Job ID
            <input name="job_id" placeholder="e.g. MEYER-2025-09-05" required>
          </label>
          <label>PDF
            <input type="file" name="file" accept="application/pdf" required>
          </label>
          <button>Upload PDF</button>
        </div>
      </form>
      <p class="muted" style="margin:.5rem 0 0">Tip: You can still add items manually later on the order page.</p>
    </section>

    <!-- Search + Table -->
    <section>
      <form method="get" action="/" class="row" style="margin-bottom:.5rem">
        <input name="q" placeholder="Search job id" value="{{ q }}">
        <button>Search</button>
      </form>

      <table border="1" cellspacing="0" cellpadding="6" class="w100">
        <thead>
          <tr>
            <th>ID</th>
            <th>Job ID</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if orders %}
          {% for o in orders %}
          <tr>
            <td>{{ o.id }}</td>
            <td>{{ o.job_id }}</td>
            <td>{{ o.created_at }}</td>
            <td>
              <a href="/orders/{{ o.id }}">View</a> |
              <a href="/orders/{{ o.id }}/settings">Settings</a> |
              <form method="post" action="/orders/{{ o.id }}/delete" style="display:inline"
                onsubmit="return confirm('Delete order {{ o.id }}?');">
                <button>Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td colspan="4" style="text-align:center" class="muted">
              No orders yet. Use the form above to upload your first PDF.
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>

      <p><a href="/settings">Go to latest order settings</a></p>
    </section>
  </div>
</body>

</html>